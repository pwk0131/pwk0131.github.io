<!-- Switch the mode between dark and light. -->

<script>
  const modeToggle = (function () {
    const MODE_KEY = 'mode';
    const MODE_ATTR = 'data-mode';
    const DARK_MODE = 'dark';
    const LIGHT_MODE = 'light';
    const ID = 'mode-toggle';

    const sysDarkPrefers = window.matchMedia('(prefers-color-scheme: dark)');

    function getMode() {
      return localStorage.getItem(MODE_KEY);
    }

    function setMode(mode) {
      document.documentElement.setAttribute(MODE_ATTR, mode);
      localStorage.setItem(MODE_KEY, mode);
    }

    function getModeStatus() {
      const storedMode = getMode();
      if (storedMode) {
        return storedMode;
      }
      return sysDarkPrefers.matches ? DARK_MODE : LIGHT_MODE;
    }

    function notify() {
      window.postMessage({
        direction: ID,
        message: getModeStatus()
      }, '*');
    }

    function flipMode() {
      if (document.documentElement.getAttribute(MODE_ATTR) === DARK_MODE) {
        setMode(LIGHT_MODE);
      } else {
        setMode(DARK_MODE);
      }
      notify();
    }

    // 초기화 로직: 페이지가 로드될 때 실행됩니다.
    const storedMode = getMode();
    if (!storedMode) {
      setMode(LIGHT_MODE); // 저장된 값이 없으면 라이트 모드를 기본으로 설정
    } else {
      setMode(storedMode); // 저장된 값이 있으면 그 값을 적용
    }

    return {
      flipMode,
      ID,
      DARK_MODE,
      LIGHT_MODE
    };
  })();
  
</script>
